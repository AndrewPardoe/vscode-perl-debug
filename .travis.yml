language: perl
os:
  - linux
  - osx
node_js:
  - "8"
perl:
  - "5.22"
  - "5.20"
  - "5.18"
  - "5.16"
  - "5.14"
cache:
  bundler: true
  directories:
  - node_modules # NPM packages
before_install:
    - nvm install 8
    - perl --version
    - node --version
    # - export PERL5OPT="-I${HOME}/perl5/lib/perl5"
    - echo $PERL5OPT
    - echo $TRAVIS_OS_NAME
    - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then cpanm PadWalker; fi
    - echo "{\"publishers\":[{\"name\":\"${VSCE_USERNAME}\",\"pat\":\"${VSCE_TOKEN}\"}]}" > ~/.vsce
    - cat ~/.vsce
install:
    - travis_retry npm install
stages:
  - test
  - name: publish
    if: branch = master
script:
    - npm run tslint
    - npm test
jobs:
  include:
    - stage: publish
      script: echo "publish"; exit 0
